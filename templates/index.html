<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>AI Creativity Study</title> <!-- Changed title -->
    <style>
        body {
            font-family: 'Arial', sans-serif; /* Example fashionable font, you can replace with others like 'Roboto', 'Lato', 'Open Sans' */
            margin: 0; /* Reset default body margin */
            padding: 20px; /* Add some padding to the body */
            background-color: #e0f7fa; /* Light Cyan - Pastel background color */
            color: #333; /* Default text color */
        }
        h1, h2 {
            color: #00796b; /* Dark Cyan - Pastel heading color */
            text-align: center; /* Center headings */
        }
         h1 {
             margin-bottom: 5px; /* Reduce space below main title */
         }
        .instructions {
            text-align: center;
            margin-bottom: 20px;
            color: #555;
            font-size: 1.1em; /* Slightly larger instruction text */
            line-height: 1.5; /* Improve readability */
        }
        .image-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px; /* Increased gap for better spacing */
            margin: 20px auto; /* Center the container and add vertical margin */
            padding: 15px; /* Add padding inside the container */
            border: 1px solid #b2dfdb; /* Light Teal - Pastel border */
            border-radius: 8px; /* Rounded corners */
            background-color: #ffffff; /* White background for the container */
            /* Ensure container takes up more width */
            width: 90%; /* Set a percentage width */
            max-width: 1200px; /* Set a maximum width for larger screens */
            justify-content: center; /* Center images within the container */
        }
        .image-item {
            cursor: grab;
            border: 2px solid transparent;
            transition: transform 0.2s ease-in-out; /* Add a subtle hover effect */
            box-shadow: 2px 2px 8px rgba(0,0,0,0.2); /* Add a subtle shadow */
            /* Adjust the image sizing */
            display: block; /* Ensure image is a block element */
            width: 100%; /* Allow image to take up container width */
            height: auto; /* Maintain aspect ratio */
            max-width: 250px; /* Adjusted max-width - experiment with this */
            object-fit: cover; /* Ensure image covers the area without stretching unnaturally */
            border-radius: 4px; /* Rounded corners for images */
        }
         .image-item:hover {
            transform: scale(1.03); /* Slightly enlarge on hover */
        }
        .ranking-area {
            border: 2px dashed #b2dfdb; /* Light Teal - Pastel dashed border */
            padding: 20px;
            min-height: 150px; /* Increased minimum height */
            display: flex;
            gap: 20px; /* Increased gap */
            flex-wrap: wrap;
            align-items: center; /* Vertically center items in ranking area */
            justify-content: center; /* Center items in ranking area */
            margin: 20px auto; /* Center the container and add vertical margin */
            width: 90%; /* Set a percentage width */
            max-width: 1200px; /* Set a maximum width */
             border-radius: 8px; /* Rounded corners */
             background-color: #ffffff; /* White background for the container */
        }
        .ranking-area .image-item {
            border: 2px solid #00796b; /* Dark Cyan - Pastel border for ranked images */
        }
        .button-container {
            margin-top: 30px; /* Increased margin */
            display: flex;
            gap: 15px; /* Increased gap */
            justify-content: center; /* Center buttons */
             margin-bottom: 30px; /* Add margin below buttons */
        }
        button {
            padding: 10px 20px;
            font-size: 1em;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #4db6ac; /* Teal - Pastel button color */
            color: white;
            transition: background-color 0.3s ease;
        }
         button:hover {
            background-color: #26a69a; /* Darker Teal on hover */
        }
        #leaderboard {
            margin: 30px auto; /* Center the leaderboard and add margin */
            list-style: none; /* Remove default list bullets */
            padding: 0;
            width: 90%; /* Set a percentage width */
            max-width: 800px; /* Set a maximum width */
        }
        #leaderboard li {
            background-color: #e0f2f7; /* Light Blue - Pastel background */
            border: 1px solid #b2ebf2; /* Light Cyan - Pastel border */
            margin-bottom: 8px;
            padding: 10px;
            border-radius: 4px;
            display: flex; /* Use flexbox for list items */
            justify-content: space-between; /* Space out filename and points */
            align-items: center;
        }
         #leaderboard li:nth-child(odd) {
            background-color: #ffffff; /* Alternate row color */
         }
         #leaderboard li img {
             margin-right: 10px;
             width: 40px; /* Thumbnail size */
             height: auto;
             border-radius: 4px; /* Rounded corners for thumbnails */
         }
    </style>
</head>
<body>
    <h1>AI Creativity Study</h1> <!-- Changed main title -->

    <h2>Images to Rank</h2>
    <p class="instructions">Drag 5 images from the area below into the Ranking Area. Place your most favorite image on the left, and your least favorite on the right.</p> <!-- Updated instructions -->
    <div id="imagesToRank" class="image-container">
        <!-- Images will be loaded here -->
    </div>

    <h2>Ranking Area</h2>
    <p class="instructions">This is where you will drop your ranked images. Ensure there are exactly 5 images here before submitting.</p> <!-- Added instruction for ranking area -->
    <div id="rankingArea" class="ranking-area" ondrop="drop(event)" ondragover="allowDrop(event)">
        <!-- Dropped images will appear here -->
    </div>

    <div class="button-container">
        <button onclick="submitRanking()">Submit Ranking</button>
        <button onclick="getNextBatch()">Get Next Batch</button>
        <!-- Removed Save and Load buttons -->
    </div>


    <h2>Leaderboard</h2>
    <ul id="leaderboard">
        <!-- Leaderboard will be updated here -->
    </ul>

    <script>
        let currentImages = []; // To store the current batch of images

        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.id);
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.getElementById(data);
            const rankingArea = document.getElementById("rankingArea");

            // Check if the dropped element is an image-item from the imagesToRank area
            if (draggedElement && draggedElement.classList.contains('image-item') && draggedElement.parentElement.id === 'imagesToRank') {
                 // Optional: Limit the number of items in the ranking area if needed
                 // if (rankingArea.children.length < 5) {
                    rankingArea.appendChild(draggedElement);
                 // } else {
                 //    alert("You can only rank 5 images at a time.");
                 // }
            }
        }

        function displayImages(imageFilenames) {
            const imagesToRankDiv = document.getElementById('imagesToRank');
            imagesToRankDiv.innerHTML = ''; // Clear previous images when showing a new batch
            currentImages = imageFilenames; // Store current batch

            imageFilenames.forEach(filename => {
                const img = document.createElement('img');
                img.src = `/image/${filename}`; // Flask route to serve images
                img.alt = filename;
                img.classList.add('image-item');
                img.draggable = true;
                img.id = `img-${filename.replace(/[^a-zA-Z0-9]/g, '-')}`; // Create a valid ID
                img.ondragstart = function(event) { drag(event); };
                imagesToRankDiv.appendChild(img);
            });
        }

        function submitRanking() {
            const rankingArea = document.getElementById('rankingArea');
            const rankedImages = Array.from(rankingArea.children).map(img => img.alt);

            if (rankedImages.length !== 5) {
                alert("Please rank exactly 5 images.");
                return;
            }

            fetch('/rank', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ rankedImages: rankedImages }),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Ranking submitted:', data);
                updateLeaderboard(data.leaderboard);
                // Clear the ranking area after submission
                rankingArea.innerHTML = '';
                 // Automatically get the next batch after submission
                 getNextBatch();

            })
            .catch((error) => {
                console.error('Error submitting ranking:', error);
                 alert("Error submitting ranking.");
            });
        }

         function updateLeaderboard(leaderboardData) {
            const leaderboardList = document.getElementById('leaderboard');
            leaderboardList.innerHTML = ''; // Clear current leaderboard

            // Sort leaderboard by points in descending order
            leaderboardData.sort((a, b) => b.points - a.points);

            leaderboardData.forEach(item => {
                const listItem = document.createElement('li');
                 // Include image thumbnail and filename in the leaderboard
                 const img = document.createElement('img');
                 img.src = `/image/${item.filename}`; // Serve thumbnail
                 img.alt = item.filename;
                 img.style.width = '40px'; // Thumbnail size
                 img.style.height = 'auto';
                 img.style.marginRight = '10px';

                const textSpan = document.createElement('span');
                textSpan.textContent = `${item.filename}: ${item.points} points`;

                listItem.appendChild(img);
                listItem.appendChild(textSpan);

                leaderboardList.appendChild(listItem);
            });
        }


        function getNextBatch() {
             fetch('/next_batch')
                .then(response => response.json())
                .then(data => {
                    if (data.images.length > 0) {
                        displayImages(data.images);
                         const rankingArea = document.getElementById('rankingArea');
                         rankingArea.innerHTML = ''; // Clear ranking area for the new batch
                    } else {
                        alert("All images have been ranked or no more images available.");
                         // Optionally display a "Task Complete" message or similar
                         const imagesToRankDiv = document.getElementById('imagesToRank');
                         imagesToRankDiv.innerHTML = '<h3>All images have been ranked!</h3>';
                    }
                     // Always fetch and update the leaderboard when getting a new batch
                     fetch('/leaderboard')
                        .then(response => response.json())
                        .then(data => {
                            updateLeaderboard(data.leaderboard);
                        })
                        .catch((error) => {
                            console.error('Error fetching leaderboard:', error);
                        });
                })
                .catch((error) => {
                    console.error('Error fetching next batch:', error);
                     alert("Error fetching next batch.");
                });
        }

        // Removed saveProgress and loadProgress functions


        // Initial load of images and leaderboard when the page loads
        getNextBatch();

    </script>
</body>
</html>